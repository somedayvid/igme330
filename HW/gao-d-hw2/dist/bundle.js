(()=>{"use strict";var e,t,n,r,a,i,o,l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"hsla(".concat(180*e/Math.PI%360,", 100%, 50%, ").concat(t,")")},u=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"black",l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5;e.save(),e.rotate(i),e.beginPath(),e.moveTo(t,n),e.lineTo(r,a),e.strokeStyle=o,e.lineWidth=l,e.stroke(),e.restore()},s=[],c={},d={},h={},f={},m={},y=!0,v=Object.freeze({gain:.5,numSamples:256}),p=(new Uint8Array(v.numSamples/2),function(e,t){var n=new(window.AudioContext||window.webkitAudioContext),r=new Audio;g(e,r);var a=n.createMediaElementSource(r),i=n.createAnalyser();i.fftSize=v.numSamples;var o=n.createGain();o.gain.value=v.gain;var l=n.createBiquadFilter(),u=n.createWaveShaper();a.connect(i),i.connect(o),o.connect(l),l.connect(u),u.connect(n.destination),t.audioElement=r,t.audioCtx=n,t.audioNode=a,t.audioAnalyser=i,t.audioGainNode=o,t.audioBiquadFilter=l,t.audioDistortion=u,t.audioPath=e,l.type="lowshelf"}),g=function(e,t){return t.src=e},w=0,b=0,S=function(){b=1},k=function(){document.querySelector("#score-display").innerHTML="Score: ".concat(String(w)),document.querySelector("#combo-display").innerHTML="Combo: ".concat(String(b))};function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,C(r.key),r)}}function B(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t,n){return(t=C(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){var t=function(e){if("object"!=q(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==q(t)?t:t+""}var F,P,L,M,j,D,N,A=[],R=[],z=[],G=[[],[],[],[]],H=[.2,.2,.05,.18],W={drums:{canSpawn:!0,number:0},other:{canSpawn:!0,number:1},bass:{canSpawn:!0,number:2},instrumental:{canSpawn:!0,number:3}},O=[],I=0,U=B((function e(t,n,r,a){var i=this,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5;x(this,e),E(this,"draw",(function(){var e;e=i.highlight&&!Q?"red":i.active?"black":"purple",function(e,t,n,r,a,i){e.save(),e.translate(t,n),u(e,-50,0,0,50,r,a,i),u(e,0,50,0,25,r,a,i),u(e,0,25,50,25,r,a,i),u(e,50,25,50,-25,r,a,i),u(e,50,-25,0,-25,r,a,i),u(e,0,-25,0,-50,r,a,i),u(e,0,-50,-50,0,r,a,i),e.restore()}(i.ctx,i.x,i.y,i.rotation,e,i.width)})),E(this,"noteRest",(function(e){i.waiting||i.expired||Q?Q&&(z.push(new V(L+65+125*e,3)),J(),i.expired=!0):(i.waiting=!0,setTimeout((function(){z.push(new V(L+65+125*e,0)),S(),i.expired=!0}),100))})),E(this,"makeExpired",(function(){i.expired=!0})),E(this,"update",(function(){K||!i.active||i.waiting||(i.y+=i.speed)})),this.ctx=t,this.x=n,this.y=r,this.width=l,this.speed=13,this.rotation=a,this.active=o,this.highlight=!1,this.expired=!1,this.missed=!1,this.waiting=!1})),V=B((function t(r,a){var i=this;switch(x(this,t),E(this,"draw",(function(){e.save(),e.fillStyle=i.fillStyle,e.fillRect(i.x,i.y,150,50),e.font="30px Arial",e.fillStyle="black",e.fillText(i.text,i.x+10,i.y+35),e.restore()})),E(this,"update",(function(){i.y+=i.speed,i.x+=i.speed,i.alpha*=.9})),this.x=r,this.y=n-n/8,this.speed=1,this.expired=!1,this.alpha=1,this.fillStyle="rgba(0,0,0,1)",this.text="",a){case 3:this.text="PERFECT!",this.fillStyle="rgba(97, 255, 126, ".concat(this.alpha,")");break;case 2:this.text="GREAT!",this.fillStyle="rgba(138, 205, 234, ".concat(this.alpha,")");break;case 1:this.text="GOOD!",this.fillStyle="rgba(213, 185, 66, ".concat(this.alpha,")");break;case 0:this.text="MISS!",this.fillStyle="rgba(211, 82, 105, ".concat(this.alpha,")")}setTimeout((function(){i.expired=!0}),250)})),Y=function(e){if(G[e].length>0){var t=X(G[e][0].y);switch(t){case 0:G[e][0].makeExpired();case-1:S();break;case 1:case 2:case 3:G[e][0].makeExpired(),J()}return t}return-1},J=function(){w+=100+b,k(),b++},X=function(e){var t=Math.abs(e-700);return t<30?3:t<40?2:t<50?1:t<65?0:-1},K=!1,Q=!1,Z={},$=1,_={s:{justPressed:!1,pressed:!1,released:!0,number:0},d:{justPressed:!1,pressed:!1,released:!0,number:1},j:{justPressed:!1,pressed:!1,released:!0,number:2},k:{justPressed:!1,pressed:!1,released:!0,number:3}},ee={showLine:!0,showBars:!0,showCircle:!0,showNotes:!0,showCircleBars:!0},te=Object.freeze({bass:"media/Taking What's Not Yours - TV Girl/bass.mp3",drums:"media/Taking What's Not Yours - TV Girl/drums.mp3",instrumental:"media/Taking What's Not Yours - TV Girl/instrumental.mp3",other:"media/Taking What's Not Yours - TV Girl/other.mp3",fullSong:"media/Taking What's Not Yours - TV Girl/original.mp3"}),ne=function(e){document.querySelector("#fs-button").onclick=function(t){var n;(n=e).requestFullscreen?n.requestFullscreen():n.mozRequestFullscreen?n.mozRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()};var t=document.querySelector("#play-button");t.onclick=function(e){"suspended"==s[0].audioCtx.state&&(s[0].audioCtx.resume(),m.audioCtx.resume()),"no"==e.target.dataset.playing?(function(){for(var e in s)s[e].audioGainNode.gain.value=0,s[e].audioElement.play(),y||m.audioElement.play();y&&(setTimeout((function(){m.audioElement.play()}),1500),y=!1)}(),e.target.dataset.playing="yes",K=!1):(function(){for(var e in s)s[e].audioElement.pause();m.audioElement.pause()}(),e.target.dataset.playing="no",K=!0),ae()};var n=document.querySelector("#volume-slider");n.oninput=function(e){var t;t=e.target.value,t=Number(t),m.audioGainNode.gain.value=t,document.querySelector("#volume-label").innerHTML="Volume: ".concat(Math.round(e.target.value/2*100))},n.dispatchEvent(new Event("input"));var r=document.querySelector("#track-select");document.querySelector("#default-track").selected=!0,r.onchange=function(e){var n;n=Z.songs[e.target.value],g("media/".concat(n,"/drums.mp3"),s[0].audioElement),g("media/".concat(n,"/other.mp3"),s[1].audioElement),g("media/".concat(n,"/bass.mp3"),s[2].audioElement),g("media/".concat(n,"/instrumental.mp3"),s[3].audioElement),g("media/".concat(n,"/original.mp3"),m.audioElement),y=!0,function(){for(var e in G)G[e]=[]}(),"yes"==t.dataset.playing&&t.dispatchEvent(new MouseEvent("click"))};var a=document.querySelector("#type-data-select");D=a.value="frequency",a.onchange=function(){D=a.value,ae()};var i=document.querySelector("#line-CB"),o=document.querySelector("#bars-CB"),l=document.querySelector("#circle-CB"),u=document.querySelector("#notes-CB"),c=document.querySelector("#circle-bars-CB"),d=document.querySelector("#autoplay-CB");i.checked=ee.showLine,o.checked=ee.showBars,l.checked=ee.showCircle,u.checked=ee.showNotes,c.checked=ee.showCircleBars,d.checked=Q,i.onchange=function(){ee.showLine=i.checked},o.onchange=function(){ee.showBars=o.checked},l.onchange=function(){ee.showCircle=l.checked},u.onchange=function(){ee.showNotes=u.checked},c.onchange=function(){ee.showCircleBars=c.checked},d.onchange=function(){Q=d.checked};var h=document.querySelector("#bass-boost-slider");h.oninput=function(e){!function(e){for(var t in s)s[t].audioBiquadFilter.type="lowshelf",s[t].audioBiquadFilter.frequency.value=1e3,s[t].audioBiquadFilter.gain.value=e;m.audioBiquadFilter.type="lowshelf",m.audioBiquadFilter.frequency.value=2e3,m.audioBiquadFilter.gain.value=e}(e.target.value),document.querySelector("#bass-label").innerHTML="Bass Boost Level: ".concat(e.target.value)},h.dispatchEvent(new Event("input"));var f=document.querySelector("#treble-boost-slider");f.oninput=function(e){!function(e){for(var t in s)s[t].audioBiquadFilter.type="highshelf",s[t].audioBiquadFilter.frequency.value=2e3,s[t].audioBiquadFilter.gain.value=e;m.audioBiquadFilter.type="highshelf",m.audioBiquadFilter.frequency.value=2e3,m.audioBiquadFilter.gain.value=e}(e.target.value),document.querySelector("#treble-label").innerHTML="Treble Boost Level: ".concat(e.target.value)},f.dispatchEvent(new Event("input")),document.addEventListener("keydown",(function(e){"s"!=e.key&&"d"!=e.key&&"j"!=e.key&&"k"!=e.key||(_[e.key].pressed=!0,_[e.key].released&&(_[e.key].justPressed=!0,_[e.key].released=!1,setTimeout((function(){_[e.key].justPressed=!1}),25)))})),document.addEventListener("keyup",(function(e){"s"!=e.key&&"d"!=e.key&&"j"!=e.key&&"k"!=e.key||(_[e.key].pressed=!1,_[e.key].released=!0)}))},re=function(){setTimeout(re,1e3/60),K||(k(),function(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("frequency"==D)for(var s in A[0].getByteFrequencyData(r),A[1].getByteFrequencyData(o),A[2].getByteFrequencyData(a),A[3].getByteFrequencyData(i),F.getByteFrequencyData(P),W)W[s].lowerLim=H[W[s].number];else if("waveform"==D)for(var c in A[0].getByteTimeDomainData(r),A[1].getByteTimeDomainData(o),A[2].getByteTimeDomainData(a),A[3].getByteTimeDomainData(i),F.getByteTimeDomainData(P),W)W[c].lowerLim=.5019607843137255;if(e.save(),e.fillStyle="black",e.rect(0,0,t,n),e.fill(),e.restore(),u.showBars){var d=(t-L)/P.length,h=t;e.save(),e.lineWidth=10;for(var f=0;f<P.length;f++){var m=P[f],y=2*f;e.strokeStyle="hsl(".concat(y,", 100%, 50%)"),e.beginPath(),e.moveTo(h,0),e.lineTo(h,n/2-m),e.stroke(),h-=d}e.restore()}if(e.save(),e.beginPath(),e.fillStyle="white",e.rect(L,0,t/3,n),e.fill(),e.closePath(),e.restore(),u.showCircleBars){I+=.01,e.save(),e.translate(M,j),e.rotate(I);for(var v=0;v<P.length;v++){var p=v/P.length*Math.PI*2,g=P[v]/2,w=2*v;e.save(),e.rotate(p),e.fillStyle="hsl(".concat(w,", 100%, 50%)"),e.fillRect(120,-2,g,4),e.restore()}e.restore()}if(u.showCircle){var b=n/4;e.save();for(var S=0;S<P.length;S++){var k=P[S]/255,q=k*b;e.beginPath(),e.fillStyle=l(I,.34-k/3),e.arc(M,j,q,0,2*Math.PI,!1),e.fill(),e.closePath()}e.restore()}if(u.showLine){var T=L+t/3,B=t/P.length;e.save(),e.beginPath();for(var x=0;x<P.length;x++){var E=P[x],C=n/2-E/255*n/2;0==x?e.moveTo(T,C):e.lineTo(T,C),T+=B}e.strokeStyle=l(I),e.lineWidth=3,e.stroke(),e.restore()}for(var N=0;N<R.length;N++){for(var J=[],X=0;X<R[N].length;X++){var Z=R[N][X]/255;J.push(Z)}var $=0;for(var ee in J)$+=J[ee];if($/=J.length,!K){var te=function(t){if(W[t].number==N&&W[t].canSpawn&&$>W[t].lowerLim)return G[W[t].number].push(new U(e,L+65+125*N,-50,Math.PI/2*N,!0,15)),W[t].canSpawn=!1,setTimeout((function(){W[t].canSpawn=!0}),225),1};for(var ne in W)if(te(ne))break}}for(var re in G)for(var ae in G[re])G[re][ae].update(),u.showNotes&&G[re][ae].draw();for(var ie in G)G[ie].length>0&&!K&&(G[ie][0].expired?G[ie].splice(0,1):G[ie][0].y>=n-n/6&&G[ie][0].noteRest(ie));if(z.length>0&&!K)for(var oe=z.length-1;oe>=0;oe--)z[oe].update(),u.showNotes&&z[oe].draw(),z[oe].expired&&z.splice(oe,1);for(var le=0;le<O.length;le++)O[le].draw();for(var ue in _)if(O[_[ue].number].highlight=_[ue].pressed,_[ue].justPressed&&!Q){var se=Y(_[ue].number);-1!=se&&z.push(new V(L+65+125*_[ue].number,se))}}(ee))},ae=function(){N.style.color="rgba(255,255,255,".concat($,")"),($*=.9)>.001?setTimeout((function(){ae()}),1e3/60):(N.firstElementChild.innerHTML="",N.lastElementChild.innerHTML="")};window.onload=function(){console.log("window.onload called"),function(){var l,u,y,v,g;l=te.bass,u=te.drums,y=te.intrumental,v=te.other,g=te.fullSong,p(u,c),p(v,d),p(l,h),p(y,f),p(g,m),s[0]=c,s[1]=d,s[2]=h,s[3]=f;var w,b,S=document.querySelector("canvas");w=function(e){Z=e,(N=document.querySelector("#text-info")).firstElementChild.innerHTML=Z.title,N.lastElementChild.innerHTML=Z.instructions,document.querySelector("title").textContent=Z.title},(b=new XMLHttpRequest).open("GET","data/av-data.json",!0),b.onload=function(){if(200===b.status){var e=JSON.parse(b.responseText);w(e)}else console.error("Error reading the shape data")},b.onerror=function(){console.error("Request failed")},b.send(),ne(S),function(l,u,s){for(var c in e=l.getContext("2d"),l.width=window.innerWidth,l.height=window.innerHeight+10,t=l.width,n=l.height,L=30,F=s.audioAnalyser,P=new Uint8Array(F.fftSize/2),u)A[c]=u[c].audioAnalyser;r=new Uint8Array(A[0].fftSize/2),o=new Uint8Array(A[1].fftSize/2),a=new Uint8Array(A[2].fftSize/2),i=new Uint8Array(A[3].fftSize/2),R[0]=r,R[1]=o,R[2]=a,R[3]=i;for(var d=0;d<4;d++)O.push(new U(e,L+65+125*d,n-n/6,Math.PI/2*d,!1));M=t/2,j=n/2+200}(S,s,m),re()}()}})();